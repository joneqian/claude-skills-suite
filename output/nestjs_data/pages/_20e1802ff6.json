{
  "url": "https://docs.nestjs.com/recipes/automock",
  "title": "",
  "content": "Suites is an open-source unit-testing framework for TypeScript dependency injection frameworks. It is used as an alternative to manually creating mocks, verbose test setup with multiple mock configurations, or working with untyped test doubles (like mocks and stubs).\n\nSuites reads metadata from nestjs services at runtime and automatically generates fully-typed mocks for all dependencies. This removes boilerplate mock setup and ensures type-safe tests. While Suites can be used alongside Test.createTestingModule(), it excels at focused unit testing. Use Test.createTestingModule() when validating module wiring, decorators, guards, and interceptors. Use Suites for fast unit tests with automatic mock generation.\n\nFor more information on module-based testing, see the testing fundamentals chapter.\n\nThis guide demonstrates using Suites to test NestJS services. It covers both isolated testing (all dependencies mocked) and sociable testing (selected real implementations).\n\nVerify NestJS runtime dependencies are installed:\n\nInstall Suites core, the NestJS adapter, and the doubles adapter:\n\nThe doubles adapter (@suites/doubles.jest) provides wrappers around Jest's mocking capabilities. It exposes mock() and stub() functions that create type-safe test doubles.\n\nEnsure Jest and TypeScript are available:\n\nCreate global.d.ts at your project root:\n\nThis guide uses a simple UserService with two dependencies:\n\nUse TestBed.solitary() to create isolated tests with all dependencies mocked:\n\nTestBed.solitary() analyzes the constructor and creates typed mocks for all dependencies. The Mocked<T> type provides IntelliSense support for mock configuration.\n\nConfigure mock behavior before compilation using .mock().impl():\n\nThe stubFn parameter corresponds to the installed doubles adapter (jest.fn() for Jest, vi.fn() for Vitest, sinon.stub() for Sinon).\n\nUse TestBed.sociable() with .expose() to use real implementations for specific dependencies:\n\n.expose(Logger) instantiates Logger with its real implementation while keeping other dependencies mocked.\n\nSuites handles custom injection tokens (strings or symbols):\n\nAccess token-based dependencies with unitRef.get():\n\nFor those who prefer direct control without TestBed, the doubles adapter package provides mock() and stub() functions:\n\nmock() creates a typed mock object, and stub() wraps the underlying mocking library (Jest in this example) to provide methods like mockResolvedValue() These functions come from the installed doubles adapter (@suites/doubles.jest), which adapts the native mocking capabilities of the test framework.\n\nUse Test.createTestingModule() for:\n\nOrganize tests by purpose: use Suites for unit tests verifying individual service behavior, and use Test.createTestingModule() for integration tests verifying module configuration.\n\nFor more information:",
  "headings": [
    {
      "level": "h3",
      "text": "Suites",
      "id": "suites"
    },
    {
      "level": "h4",
      "text": "Getting started#",
      "id": "getting-started"
    },
    {
      "level": "h4",
      "text": "Install Suites#",
      "id": "install-suites"
    },
    {
      "level": "h4",
      "text": "Set up type definitions#",
      "id": "set-up-type-definitions"
    },
    {
      "level": "h4",
      "text": "Create a sample service#",
      "id": "create-a-sample-service"
    },
    {
      "level": "h4",
      "text": "Write a unit test#",
      "id": "write-a-unit-test"
    },
    {
      "level": "h4",
      "text": "Pre-compile mock configuration#",
      "id": "pre-compile-mock-configuration"
    },
    {
      "level": "h4",
      "text": "Testing with real dependencies#",
      "id": "testing-with-real-dependencies"
    },
    {
      "level": "h4",
      "text": "Token-based dependencies#",
      "id": "token-based-dependencies"
    },
    {
      "level": "h4",
      "text": "Using mock() and stub() directly#",
      "id": "using-mock-and-stub-directly"
    },
    {
      "level": "h4",
      "text": "Summary#",
      "id": "summary"
    }
  ],
  "code_samples": [
    {
      "code": "$ npm install @nestjs/common @nestjs/core reflect-metadata",
      "language": "bash"
    },
    {
      "code": "$ npm install --save-dev @suites/unit @suites/di.nestjs @suites/doubles.jest",
      "language": "bash"
    },
    {
      "code": "$ npm install --save-dev ts-jest @types/jest jest typescript",
      "language": "bash"
    },
    {
      "code": "$ npm install --save-dev @suites/unit @suites/di.nestjs @suites/doubles.vitest",
      "language": "bash"
    },
    {
      "code": "$ npm install --save-dev @suites/unit @suites/di.nestjs @suites/doubles.sinon",
      "language": "bash"
    },
    {
      "code": "/// <reference types=\"@suites/doubles.jest/unit\" />\n/// <reference types=\"@suites/di.nestjs/types\" />",
      "language": "typescript"
    },
    {
      "code": "import { Injectable } from '@nestjs/common';\n\n@Injectable()\nexport class UserRepository {\n  async findById(id: string): Promise<User | null> {\n    // Database query\n  }\n\n  async save(user: User): Promise<User> {\n    // Database save\n  }\n}",
      "language": "typescript"
    },
    {
      "code": "import { Injectable, NotFoundException } from '@nestjs/common';\nimport { Logger } from '@nestjs/common';\n\n@Injectable()\nexport class UserService {\n  constructor(\n    private repository: UserRepository,\n    private logger: Logger,\n  ) {}\n\n  async findById(id: string): Promise<User> {\n    const user = await this.repository.findById(id);\n    if (!user) {\n      throw new NotFoundException(`User ${id} not found`);\n    }\n    this.logger.log(`Found user ${id}`);\n    return user;\n  }\n\n  async create(email: string, name: string): Promise<User> {\n    const user = { id: generateId(), email, name };\n    await this.repository.save(user);\n    this.logger.log(`Created user ${user.id}`);\n    return user;\n  }\n}",
      "language": "typescript"
    },
    {
      "code": "import { TestBed, type Mocked } from '@suites/unit';\nimport { UserService } from './user.service';\nimport { UserRepository } from './user.repository';\nimport { Logger } from '@nestjs/common';\n\ndescribe('User Service Unit Spec', () => {\n  let userService: UserService;\n  let repository: Mocked<UserRepository>;\n  let logger: Mocked<Logger>;\n\n  beforeAll(async () => {\n    const { unit, unitRef } = await TestBed.solitary(UserService).compile();\n\n    userService = unit;\n    repository = unitRef.get(UserRepository);\n    logger = unitRef.get(Logger);\n  });\n\n  it('should find user by id', async () => {\n    const user = { id: '1', email: 'test@example.com', name: 'Test' };\n    repository.findById.mockResolvedValue(user);\n\n    const result = await userService.findById('1');\n\n    expect(result).toEqual(user);\n    expect(logger.log).toHaveBeenCalled();\n  });\n});",
      "language": "typescript"
    },
    {
      "code": "import { TestBed } from '@suites/unit';\nimport { UserService } from './user.service';\nimport { UserRepository } from './user.repository';\n\ndescribe('User Service Unit Spec - pre-configured', () => {\n  let unit: UserService;\n  let repository: Mocked<UserRepository>;\n  \n  beforeAll(async () => {\n    const { unit: underTest, unitRef } = await TestBed.solitary(UserService)\n      .mock(UserRepository)\n      .impl(stubFn => ({\n        findById: stubFn().mockResolvedValue({ id: '1', email: 'test@example.com', name: 'Test' })\n      }))\n      .compile();\n    \n    repository = unitRef.get(UserRepository);\n    unit = underTest;\n  })\n  \n  it('should find user with pre-configured mock', async () => {\n    const result = await unit.findById('1');\n    \n    expect(repository.findById).toHaveBeenCalled();\n    expect(result.email).toBe('test@example.com');\n  });\n});",
      "language": "typescript"
    },
    {
      "code": "import { TestBed, Mocked } from '@suites/unit';\nimport { UserService } from './user.service';\nimport { UserRepository } from './user.repository';\nimport { Logger } from '@nestjs/common';\n\ndescribe('UserService - with real logger', () => {\n  let userService: UserService;\n  let repository: Mocked<UserRepository>;\n\n  beforeAll(async () => {\n    const { unit, unitRef } = await TestBed.sociable(UserService)\n      .expose(Logger)\n      .compile();\n\n    userService = unit;\n    repository = unitRef.get(UserRepository);\n  });\n\n  it('should log when finding user', async () => {\n    const user = { id: '1', email: 'test@example.com' };\n    repository.findById.mockResolvedValue(user);\n\n    await userService.findById('1');\n\n    // Logger actually executes, no mock needed\n  });\n});",
      "language": "typescript"
    },
    {
      "code": "import { Injectable, Inject } from '@nestjs/common';\n\nexport const CONFIG_OPTIONS = 'CONFIG_OPTIONS';\n\n@Injectable()\nexport class ConfigService {\n  constructor(\n    @Inject(CONFIG_OPTIONS) private options: { apiKey: string },\n  ) {}\n\n  getApiKey(): string {\n    return this.options.apiKey;\n  }\n}",
      "language": "typescript"
    },
    {
      "code": "import { TestBed } from '@suites/unit';\nimport { ConfigService, CONFIG_OPTIONS, ConfigOptions } from './config.service';\n\ndescribe('Config Service Unit Spec', () => {\n  let configService: ConfigService;\n  let options: ConfigOptions;\n\n  beforeAll(async () => {\n    const { unit, unitRef } = await TestBed.solitary(ConfigService).compile();\n    configService = unit;\n\n    options = unitRef.get<ConfigOptions>(CONFIG_OPTIONS);\n  });\n\n  it('should return api key', () => { ... });\n});",
      "language": "typescript"
    },
    {
      "code": "import { mock } from '@suites/unit';\nimport { UserRepository } from './user.repository';\n\ndescribe('User Service Unit Spec', () => {\n  it('should work with direct mocks', async () => {\n    const repository = mock<UserRepository>();\n    const logger = mock<Logger>();\n\n    const service = new UserService(repository, logger);\n\n    // ...\n  });\n});",
      "language": "typescript"
    }
  ],
  "patterns": [],
  "links": [
    "https://docs.nestjs.com/first-steps",
    "https://docs.nestjs.com/controllers",
    "https://docs.nestjs.com/providers",
    "https://docs.nestjs.com/modules",
    "https://docs.nestjs.com/middleware",
    "https://docs.nestjs.com/exception-filters",
    "https://docs.nestjs.com/pipes",
    "https://docs.nestjs.com/guards",
    "https://docs.nestjs.com/interceptors",
    "https://docs.nestjs.com/custom-decorators",
    "https://docs.nestjs.com/fundamentals/custom-providers",
    "https://docs.nestjs.com/fundamentals/async-providers",
    "https://docs.nestjs.com/fundamentals/dynamic-modules",
    "https://docs.nestjs.com/fundamentals/injection-scopes",
    "https://docs.nestjs.com/fundamentals/circular-dependency",
    "https://docs.nestjs.com/fundamentals/module-ref",
    "https://docs.nestjs.com/fundamentals/lazy-loading-modules",
    "https://docs.nestjs.com/fundamentals/execution-context",
    "https://docs.nestjs.com/fundamentals/lifecycle-events",
    "https://docs.nestjs.com/fundamentals/discovery-service",
    "https://docs.nestjs.com/fundamentals/platform-agnosticism",
    "https://docs.nestjs.com/fundamentals/testing",
    "https://docs.nestjs.com/techniques/configuration",
    "https://docs.nestjs.com/techniques/database",
    "https://docs.nestjs.com/techniques/mongodb",
    "https://docs.nestjs.com/techniques/validation",
    "https://docs.nestjs.com/techniques/caching",
    "https://docs.nestjs.com/techniques/serialization",
    "https://docs.nestjs.com/techniques/versioning",
    "https://docs.nestjs.com/techniques/task-scheduling",
    "https://docs.nestjs.com/techniques/queues",
    "https://docs.nestjs.com/techniques/logger",
    "https://docs.nestjs.com/techniques/cookies",
    "https://docs.nestjs.com/techniques/events",
    "https://docs.nestjs.com/techniques/compression",
    "https://docs.nestjs.com/techniques/file-upload",
    "https://docs.nestjs.com/techniques/streaming-files",
    "https://docs.nestjs.com/techniques/http-module",
    "https://docs.nestjs.com/techniques/session",
    "https://docs.nestjs.com/techniques/mvc",
    "https://docs.nestjs.com/techniques/performance",
    "https://docs.nestjs.com/techniques/server-sent-events",
    "https://docs.nestjs.com/security/authentication",
    "https://docs.nestjs.com/security/authorization",
    "https://docs.nestjs.com/security/encryption-and-hashing",
    "https://docs.nestjs.com/security/helmet",
    "https://docs.nestjs.com/security/cors",
    "https://docs.nestjs.com/security/csrf",
    "https://docs.nestjs.com/security/rate-limiting",
    "https://docs.nestjs.com/graphql/quick-start",
    "https://docs.nestjs.com/graphql/resolvers",
    "https://docs.nestjs.com/graphql/mutations",
    "https://docs.nestjs.com/graphql/subscriptions",
    "https://docs.nestjs.com/graphql/scalars",
    "https://docs.nestjs.com/graphql/directives",
    "https://docs.nestjs.com/graphql/interfaces",
    "https://docs.nestjs.com/graphql/unions-and-enums",
    "https://docs.nestjs.com/graphql/field-middleware",
    "https://docs.nestjs.com/graphql/mapped-types",
    "https://docs.nestjs.com/graphql/plugins",
    "https://docs.nestjs.com/graphql/complexity",
    "https://docs.nestjs.com/graphql/extensions",
    "https://docs.nestjs.com/graphql/cli-plugin",
    "https://docs.nestjs.com/graphql/generating-sdl",
    "https://docs.nestjs.com/graphql/sharing-models",
    "https://docs.nestjs.com/graphql/other-features",
    "https://docs.nestjs.com/graphql/federation",
    "https://docs.nestjs.com/websockets/gateways",
    "https://docs.nestjs.com/websockets/exception-filters",
    "https://docs.nestjs.com/websockets/pipes",
    "https://docs.nestjs.com/websockets/guards",
    "https://docs.nestjs.com/websockets/interceptors",
    "https://docs.nestjs.com/websockets/adapter",
    "https://docs.nestjs.com/microservices/basics",
    "https://docs.nestjs.com/microservices/redis",
    "https://docs.nestjs.com/microservices/mqtt",
    "https://docs.nestjs.com/microservices/nats",
    "https://docs.nestjs.com/microservices/rabbitmq",
    "https://docs.nestjs.com/microservices/kafka",
    "https://docs.nestjs.com/microservices/grpc",
    "https://docs.nestjs.com/microservices/custom-transport",
    "https://docs.nestjs.com/microservices/exception-filters",
    "https://docs.nestjs.com/microservices/pipes",
    "https://docs.nestjs.com/microservices/guards",
    "https://docs.nestjs.com/microservices/interceptors",
    "https://docs.nestjs.com/standalone-applications",
    "https://docs.nestjs.com/cli/overview",
    "https://docs.nestjs.com/cli/monorepo",
    "https://docs.nestjs.com/cli/libraries",
    "https://docs.nestjs.com/cli/usages",
    "https://docs.nestjs.com/cli/scripts",
    "https://docs.nestjs.com/openapi/introduction",
    "https://docs.nestjs.com/openapi/types-and-parameters",
    "https://docs.nestjs.com/openapi/operations",
    "https://docs.nestjs.com/openapi/security",
    "https://docs.nestjs.com/openapi/mapped-types",
    "https://docs.nestjs.com/openapi/decorators",
    "https://docs.nestjs.com/openapi/cli-plugin",
    "https://docs.nestjs.com/openapi/other-features",
    "https://docs.nestjs.com/recipes/repl",
    "https://docs.nestjs.com/recipes/crud-generator",
    "https://docs.nestjs.com/recipes/swc",
    "https://docs.nestjs.com/recipes/passport",
    "https://docs.nestjs.com/recipes/hot-reload",
    "https://docs.nestjs.com/recipes/mikroorm",
    "https://docs.nestjs.com/recipes/sql-typeorm",
    "https://docs.nestjs.com/recipes/mongodb",
    "https://docs.nestjs.com/recipes/sql-sequelize",
    "https://docs.nestjs.com/recipes/router-module",
    "https://docs.nestjs.com/recipes/swagger",
    "https://docs.nestjs.com/recipes/terminus",
    "https://docs.nestjs.com/recipes/cqrs",
    "https://docs.nestjs.com/recipes/documentation",
    "https://docs.nestjs.com/recipes/prisma",
    "https://docs.nestjs.com/recipes/sentry",
    "https://docs.nestjs.com/recipes/serve-static",
    "https://docs.nestjs.com/recipes/nest-commander",
    "https://docs.nestjs.com/recipes/async-local-storage",
    "https://docs.nestjs.com/recipes/necord",
    "https://docs.nestjs.com/recipes/suites",
    "https://docs.nestjs.com/faq/serverless",
    "https://docs.nestjs.com/faq/http-adapter",
    "https://docs.nestjs.com/faq/keep-alive-connections",
    "https://docs.nestjs.com/faq/global-prefix",
    "https://docs.nestjs.com/faq/raw-body",
    "https://docs.nestjs.com/faq/hybrid-application",
    "https://docs.nestjs.com/faq/multiple-servers",
    "https://docs.nestjs.com/faq/request-lifecycle",
    "https://docs.nestjs.com/faq/common-errors"
  ]
}