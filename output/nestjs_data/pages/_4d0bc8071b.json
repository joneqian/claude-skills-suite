{
  "url": "https://docs.nestjs.com/websockets/gateways",
  "title": "",
  "content": "Most of the concepts discussed elsewhere in this documentation, such as dependency injection, decorators, exception filters, pipes, guards and interceptors, apply equally to gateways. Wherever possible, Nest abstracts implementation details so that the same components can run across HTTP-based platforms, WebSockets, and Microservices. This section covers the aspects of Nest that are specific to WebSockets.\n\nIn Nest, a gateway is simply a class annotated with @WebSocketGateway() decorator. Technically, gateways are platform-agnostic which makes them compatible with any WebSockets library once an adapter is created. There are two WS platforms supported out-of-the-box: socket.io and ws. You can choose the one that best suits your needs. Also, you can build your own adapter by following this guide.\n\nTo start building WebSockets-based applications, first install the required package:\n\nIn general, each gateway is listening on the same port as the HTTP server, unless your app is not a web application, or you have changed the port manually. This default behavior can be modified by passing an argument to the @WebSocketGateway(80) decorator where 80 is a chosen port number. You can also set a namespace used by the gateway using the following construction:\n\nYou can pass any supported option to the socket constructor with the second argument to the @WebSocketGateway() decorator, as shown below:\n\nThe gateway is now listening, but we have not yet subscribed to any incoming messages. Let's create a handler that will subscribe to the events messages and respond to the user with the exact same data.\n\nOnce the gateway is created, we can register it in our module.\n\nYou can also pass in a property key to the decorator to extract it from the incoming message body:\n\nIf you would prefer not to use decorators, the following code is functionally equivalent:\n\nIn the example above, the handleEvent() function takes two arguments. The first one is a platform-specific socket instance, while the second one is the data received from the client. This approach is not recommended though, because it requires mocking the socket instance in each unit test.\n\nOnce the events message is received, the handler sends an acknowledgment with the same data that was sent over the network. In addition, it's possible to emit messages using a library-specific approach, for example, by making use of client.emit() method. In order to access a connected socket instance, use @ConnectedSocket() decorator.\n\nHowever, in this case, you won't be able to leverage interceptors. If you don't want to respond to the user, you can simply skip the return statement (or explicitly return a \"falsy\" value, e.g. undefined).\n\nNow when a client emits the message as follows:\n\nThe handleEvent() method will be executed. In order to listen for messages emitted from within the above handler, the client has to attach a corresponding acknowledgment listener:\n\nWhile returning a value from a message handler implicitly sends an acknowledgement, advanced scenarios often require direct control over the acknowledgement callback.\n\nThe @Ack() parameter decorator allows injecting the ack callback function directly into a message handler. Without using the decorator, this callback is passed as the third argument of the method.\n\nThe acknowledgment is dispatched only once. Furthermore, it is not supported by native WebSockets implementation. To solve this limitation, you may return an object which consists of two properties. The event which is a name of the emitted event and the data that has to be forwarded to the client.\n\nIn order to listen for the incoming response(s), the client has to apply another event listener.\n\nMessage handlers are able to respond either synchronously or asynchronously. Hence, async methods are supported. A message handler is also able to return an Observable, in which case the result values will be emitted until the stream is completed.\n\nIn the example above, the message handler will respond 3 times (with each item from the array).\n\nThere are 3 useful lifecycle hooks available. All of them have corresponding interfaces and are described in the following table:\n\nOccasionally, you may want to have a direct access to the native, platform-specific server instance. The reference to this object is passed as an argument to the afterInit() method (OnGatewayInit interface). Another option is to use the @WebSocketServer() decorator.\n\nAlso, you can retrieve the corresponding namespace using the namespace attribute, as follows:\n\n@WebSocketServer() decorator injects a server instance by referencing the metadata stored by the @WebSocketGateway() decorator. If you provide the namespace option to the @WebSocketGateway() decorator, @WebSocketServer() decorator returns a Namespace instance instead of a Server instance.\n\nNest will automatically assign the server instance to this property once it is ready to use.\n\nOfficial enterprise support Providing technical guidance Performing in-depth code reviews Mentoring team members Advising best practices Explore more\n\nA working example is available here.",
  "headings": [
    {
      "level": "h3",
      "text": "Gateways",
      "id": "gateways"
    },
    {
      "level": "h4",
      "text": "Installation#",
      "id": "installation"
    },
    {
      "level": "h4",
      "text": "Overview#",
      "id": "overview"
    },
    {
      "level": "h4",
      "text": "Multiple responses#",
      "id": "multiple-responses"
    },
    {
      "level": "h4",
      "text": "Asynchronous responses#",
      "id": "asynchronous-responses"
    },
    {
      "level": "h4",
      "text": "Lifecycle hooks#",
      "id": "lifecycle-hooks"
    },
    {
      "level": "h4",
      "text": "Server and Namespace#",
      "id": "server-and-namespace"
    },
    {
      "level": "h2",
      "text": "Official enterprise support",
      "id": ""
    },
    {
      "level": "h4",
      "text": "Example#",
      "id": "example"
    }
  ],
  "code_samples": [
    {
      "code": "$ npm i --save @nestjs/websockets @nestjs/platform-socket.io",
      "language": "typescript"
    },
    {
      "code": "$ npm i --save @nestjs/websockets @nestjs/platform-socket.io",
      "language": "typescript"
    },
    {
      "code": "@WebSocketGateway(80, { namespace: 'events' })",
      "language": "typescript"
    },
    {
      "code": "@WebSocketGateway(81, { transports: ['websocket'] })",
      "language": "typescript"
    },
    {
      "code": "@SubscribeMessage('events')\nhandleEvent(@MessageBody() data: string): string {\n  return data;\n}",
      "language": "typescript"
    },
    {
      "code": "@Bind(MessageBody())\n@SubscribeMessage('events')\nhandleEvent(data) {\n  return data;\n}",
      "language": "typescript"
    },
    {
      "code": "@Module({\n  providers: [EventsGateway]\n})\nexport class EventsModule {}",
      "language": "typescript"
    },
    {
      "code": "@SubscribeMessage('events')\nhandleEvent(@MessageBody('id') id: number): number {\n  // id === messageBody.id\n  return id;\n}",
      "language": "typescript"
    },
    {
      "code": "@Bind(MessageBody('id'))\n@SubscribeMessage('events')\nhandleEvent(id) {\n  // id === messageBody.id\n  return id;\n}",
      "language": "typescript"
    },
    {
      "code": "@SubscribeMessage('events')\nhandleEvent(client: Socket, data: string): string {\n  return data;\n}",
      "language": "typescript"
    },
    {
      "code": "@SubscribeMessage('events')\nhandleEvent(client, data) {\n  return data;\n}",
      "language": "typescript"
    },
    {
      "code": "@SubscribeMessage('events')\nhandleEvent(\n  @MessageBody() data: string,\n  @ConnectedSocket() client: Socket,\n): string {\n  return data;\n}",
      "language": "typescript"
    },
    {
      "code": "@Bind(MessageBody(), ConnectedSocket())\n@SubscribeMessage('events')\nhandleEvent(data, client) {\n  return data;\n}",
      "language": "typescript"
    },
    {
      "code": "socket.emit('events', { name: 'Nest' });",
      "language": "typescript"
    },
    {
      "code": "socket.emit('events', { name: 'Nest' }, (data) => console.log(data));",
      "language": "typescript"
    },
    {
      "code": "@SubscribeMessage('events')\nhandleEvent(\n  @MessageBody() data: string,\n  @Ack() ack: (response: { status: string; data: string }) => void,\n) {\n  ack({ status: 'received', data });\n}",
      "language": "typescript"
    },
    {
      "code": "@Bind(MessageBody(), Ack())\n@SubscribeMessage('events')\nhandleEvent(data, ack) {\n  ack({ status: 'received', data });\n}",
      "language": "typescript"
    },
    {
      "code": "@SubscribeMessage('events')\nhandleEvent(@MessageBody() data: unknown): WsResponse<unknown> {\n  const event = 'events';\n  return { event, data };\n}",
      "language": "typescript"
    },
    {
      "code": "@Bind(MessageBody())\n@SubscribeMessage('events')\nhandleEvent(data) {\n  const event = 'events';\n  return { event, data };\n}",
      "language": "typescript"
    },
    {
      "code": "socket.on('events', (data) => console.log(data));",
      "language": "typescript"
    },
    {
      "code": "@SubscribeMessage('events')\nonEvent(@MessageBody() data: unknown): Observable<WsResponse<number>> {\n  const event = 'events';\n  const response = [1, 2, 3];\n\n  return from(response).pipe(\n    map(data => ({ event, data })),\n  );\n}",
      "language": "typescript"
    },
    {
      "code": "@Bind(MessageBody())\n@SubscribeMessage('events')\nonEvent(data) {\n  const event = 'events';\n  const response = [1, 2, 3];\n\n  return from(response).pipe(\n    map(data => ({ event, data })),\n  );\n}",
      "language": "typescript"
    },
    {
      "code": "@WebSocketServer()\nserver: Server;",
      "language": "typescript"
    },
    {
      "code": "@WebSocketGateway({ namespace: 'my-namespace' })\nexport class EventsGateway {\n  @WebSocketServer()\n  namespace: Namespace;\n}",
      "language": "typescript"
    }
  ],
  "patterns": [],
  "links": [
    "https://docs.nestjs.com/first-steps",
    "https://docs.nestjs.com/controllers",
    "https://docs.nestjs.com/providers",
    "https://docs.nestjs.com/modules",
    "https://docs.nestjs.com/middleware",
    "https://docs.nestjs.com/exception-filters",
    "https://docs.nestjs.com/pipes",
    "https://docs.nestjs.com/guards",
    "https://docs.nestjs.com/interceptors",
    "https://docs.nestjs.com/custom-decorators",
    "https://docs.nestjs.com/fundamentals/custom-providers",
    "https://docs.nestjs.com/fundamentals/async-providers",
    "https://docs.nestjs.com/fundamentals/dynamic-modules",
    "https://docs.nestjs.com/fundamentals/injection-scopes",
    "https://docs.nestjs.com/fundamentals/circular-dependency",
    "https://docs.nestjs.com/fundamentals/module-ref",
    "https://docs.nestjs.com/fundamentals/lazy-loading-modules",
    "https://docs.nestjs.com/fundamentals/execution-context",
    "https://docs.nestjs.com/fundamentals/lifecycle-events",
    "https://docs.nestjs.com/fundamentals/discovery-service",
    "https://docs.nestjs.com/fundamentals/platform-agnosticism",
    "https://docs.nestjs.com/fundamentals/testing",
    "https://docs.nestjs.com/techniques/configuration",
    "https://docs.nestjs.com/techniques/database",
    "https://docs.nestjs.com/techniques/mongodb",
    "https://docs.nestjs.com/techniques/validation",
    "https://docs.nestjs.com/techniques/caching",
    "https://docs.nestjs.com/techniques/serialization",
    "https://docs.nestjs.com/techniques/versioning",
    "https://docs.nestjs.com/techniques/task-scheduling",
    "https://docs.nestjs.com/techniques/queues",
    "https://docs.nestjs.com/techniques/logger",
    "https://docs.nestjs.com/techniques/cookies",
    "https://docs.nestjs.com/techniques/events",
    "https://docs.nestjs.com/techniques/compression",
    "https://docs.nestjs.com/techniques/file-upload",
    "https://docs.nestjs.com/techniques/streaming-files",
    "https://docs.nestjs.com/techniques/http-module",
    "https://docs.nestjs.com/techniques/session",
    "https://docs.nestjs.com/techniques/mvc",
    "https://docs.nestjs.com/techniques/performance",
    "https://docs.nestjs.com/techniques/server-sent-events",
    "https://docs.nestjs.com/security/authentication",
    "https://docs.nestjs.com/security/authorization",
    "https://docs.nestjs.com/security/encryption-and-hashing",
    "https://docs.nestjs.com/security/helmet",
    "https://docs.nestjs.com/security/cors",
    "https://docs.nestjs.com/security/csrf",
    "https://docs.nestjs.com/security/rate-limiting",
    "https://docs.nestjs.com/graphql/quick-start",
    "https://docs.nestjs.com/graphql/resolvers",
    "https://docs.nestjs.com/graphql/mutations",
    "https://docs.nestjs.com/graphql/subscriptions",
    "https://docs.nestjs.com/graphql/scalars",
    "https://docs.nestjs.com/graphql/directives",
    "https://docs.nestjs.com/graphql/interfaces",
    "https://docs.nestjs.com/graphql/unions-and-enums",
    "https://docs.nestjs.com/graphql/field-middleware",
    "https://docs.nestjs.com/graphql/mapped-types",
    "https://docs.nestjs.com/graphql/plugins",
    "https://docs.nestjs.com/graphql/complexity",
    "https://docs.nestjs.com/graphql/extensions",
    "https://docs.nestjs.com/graphql/cli-plugin",
    "https://docs.nestjs.com/graphql/generating-sdl",
    "https://docs.nestjs.com/graphql/sharing-models",
    "https://docs.nestjs.com/graphql/other-features",
    "https://docs.nestjs.com/graphql/federation",
    "https://docs.nestjs.com/websockets/gateways",
    "https://docs.nestjs.com/websockets/exception-filters",
    "https://docs.nestjs.com/websockets/pipes",
    "https://docs.nestjs.com/websockets/guards",
    "https://docs.nestjs.com/websockets/interceptors",
    "https://docs.nestjs.com/websockets/adapter",
    "https://docs.nestjs.com/microservices/basics",
    "https://docs.nestjs.com/microservices/redis",
    "https://docs.nestjs.com/microservices/mqtt",
    "https://docs.nestjs.com/microservices/nats",
    "https://docs.nestjs.com/microservices/rabbitmq",
    "https://docs.nestjs.com/microservices/kafka",
    "https://docs.nestjs.com/microservices/grpc",
    "https://docs.nestjs.com/microservices/custom-transport",
    "https://docs.nestjs.com/microservices/exception-filters",
    "https://docs.nestjs.com/microservices/pipes",
    "https://docs.nestjs.com/microservices/guards",
    "https://docs.nestjs.com/microservices/interceptors",
    "https://docs.nestjs.com/standalone-applications",
    "https://docs.nestjs.com/cli/overview",
    "https://docs.nestjs.com/cli/monorepo",
    "https://docs.nestjs.com/cli/libraries",
    "https://docs.nestjs.com/cli/usages",
    "https://docs.nestjs.com/cli/scripts",
    "https://docs.nestjs.com/openapi/introduction",
    "https://docs.nestjs.com/openapi/types-and-parameters",
    "https://docs.nestjs.com/openapi/operations",
    "https://docs.nestjs.com/openapi/security",
    "https://docs.nestjs.com/openapi/mapped-types",
    "https://docs.nestjs.com/openapi/decorators",
    "https://docs.nestjs.com/openapi/cli-plugin",
    "https://docs.nestjs.com/openapi/other-features",
    "https://docs.nestjs.com/recipes/repl",
    "https://docs.nestjs.com/recipes/crud-generator",
    "https://docs.nestjs.com/recipes/swc",
    "https://docs.nestjs.com/recipes/passport",
    "https://docs.nestjs.com/recipes/hot-reload",
    "https://docs.nestjs.com/recipes/mikroorm",
    "https://docs.nestjs.com/recipes/sql-typeorm",
    "https://docs.nestjs.com/recipes/mongodb",
    "https://docs.nestjs.com/recipes/sql-sequelize",
    "https://docs.nestjs.com/recipes/router-module",
    "https://docs.nestjs.com/recipes/swagger",
    "https://docs.nestjs.com/recipes/terminus",
    "https://docs.nestjs.com/recipes/cqrs",
    "https://docs.nestjs.com/recipes/documentation",
    "https://docs.nestjs.com/recipes/prisma",
    "https://docs.nestjs.com/recipes/sentry",
    "https://docs.nestjs.com/recipes/serve-static",
    "https://docs.nestjs.com/recipes/nest-commander",
    "https://docs.nestjs.com/recipes/async-local-storage",
    "https://docs.nestjs.com/recipes/necord",
    "https://docs.nestjs.com/recipes/suites",
    "https://docs.nestjs.com/faq/serverless",
    "https://docs.nestjs.com/faq/http-adapter",
    "https://docs.nestjs.com/faq/keep-alive-connections",
    "https://docs.nestjs.com/faq/global-prefix",
    "https://docs.nestjs.com/faq/raw-body",
    "https://docs.nestjs.com/faq/hybrid-application",
    "https://docs.nestjs.com/faq/multiple-servers",
    "https://docs.nestjs.com/faq/request-lifecycle",
    "https://docs.nestjs.com/faq/common-errors"
  ]
}