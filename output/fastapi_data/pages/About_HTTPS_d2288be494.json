{
  "url": "https://fastapi.tiangolo.com/deployment/https/",
  "title": "About HTTPSÂ¶",
  "content": "It is easy to assume that HTTPS is something that is just \"enabled\" or not.\n\nBut it is way more complex than that.\n\nIf you are in a hurry or don't care, continue with the next sections for step by step instructions to set everything up with different techniques.\n\nTo learn the basics of HTTPS, from a consumer perspective, check https://howhttps.works/.\n\nNow, from a developer's perspective, here are several things to keep in mind while thinking about HTTPS:\n\nIt is a common practice to have one program/HTTP server running on the server (the machine, host, etc.) and managing all the HTTPS parts: receiving the encrypted HTTPS requests, sending the decrypted HTTP requests to the actual HTTP application running in the same server (the FastAPI application, in this case), take the HTTP response from the application, encrypt it using the appropriate HTTPS certificate and sending it back to the client using HTTPS. This server is often called a TLS Termination Proxy.\n\nSome of the options you could use as a TLS Termination Proxy are:\n\nBefore Let's Encrypt, these HTTPS certificates were sold by trusted third parties.\n\nThe process to acquire one of these certificates used to be cumbersome, require quite some paperwork and the certificates were quite expensive.\n\nBut then Let's Encrypt was created.\n\nIt is a project from the Linux Foundation. It provides HTTPS certificates for free, in an automated way. These certificates use all the standard cryptographic security, and are short-lived (about 3 months), so the security is actually better because of their reduced lifespan.\n\nThe domains are securely verified and the certificates are generated automatically. This also allows automating the renewal of these certificates.\n\nThe idea is to automate the acquisition and renewal of these certificates so that you can have secure HTTPS, for free, forever.\n\nHere's an example of how an HTTPS API could look like, step by step, paying attention mainly to the ideas important for developers.\n\nIt would probably all start by you acquiring some domain name. Then, you would configure it in a DNS server (possibly your same cloud provider).\n\nYou would probably get a cloud server (a virtual machine) or something similar, and it would have a fixed public IP address.\n\nIn the DNS server(s) you would configure a record (an \"A record\") to point your domain to the public IP address of your server.\n\nYou would probably do this just once, the first time, when setting everything up.\n\nThis Domain Name part is way before HTTPS, but as everything depends on the domain and the IP address, it's worth mentioning it here.\n\nNow let's focus on all the actual HTTPS parts.\n\nFirst, the browser would check with the DNS servers what is the IP for the domain, in this case, someapp.example.com.\n\nThe DNS servers would tell the browser to use some specific IP address. That would be the public IP address used by your server, that you configured in the DNS servers.\n\nThe browser would then communicate with that IP address on port 443 (the HTTPS port).\n\nThe first part of the communication is just to establish the connection between the client and the server and to decide the cryptographic keys they will use, etc.\n\nThis interaction between the client and the server to establish the TLS connection is called the TLS handshake.\n\nOnly one process in the server can be listening on a specific port in a specific IP address. There could be other processes listening on other ports in the same IP address, but only one for each combination of IP address and port.\n\nTLS (HTTPS) uses the specific port 443 by default. So that's the port we would need.\n\nAs only one process can be listening on this port, the process that would do it would be the TLS Termination Proxy.\n\nThe TLS Termination Proxy would have access to one or more TLS certificates (HTTPS certificates).\n\nUsing the SNI extension discussed above, the TLS Termination Proxy would check which of the TLS (HTTPS) certificates available it should use for this connection, using the one that matches the domain expected by the client.\n\nIn this case, it would use the certificate for someapp.example.com.\n\nThe client already trusts the entity that generated that TLS certificate (in this case Let's Encrypt, but we'll see about that later), so it can verify that the certificate is valid.\n\nThen, using the certificate, the client and the TLS Termination Proxy decide how to encrypt the rest of the TCP communication. This completes the TLS Handshake part.\n\nAfter this, the client and the server have an encrypted TCP connection, this is what TLS provides. And then they can use that connection to start the actual HTTP communication.\n\nAnd that's what HTTPS is, it's just plain HTTP inside a secure TLS connection instead of a pure (unencrypted) TCP connection.\n\nNotice that the encryption of the communication happens at the TCP level, not at the HTTP level.\n\nNow that the client and server (specifically the browser and the TLS Termination Proxy) have an encrypted TCP connection, they can start the HTTP communication.\n\nSo, the client sends an HTTPS request. This is just an HTTP request through an encrypted TLS connection.\n\nThe TLS Termination Proxy would use the encryption agreed to decrypt the request, and would transmit the plain (decrypted) HTTP request to the process running the application (for example a process with Uvicorn running the FastAPI application).\n\nThe application would process the request and send a plain (unencrypted) HTTP response to the TLS Termination Proxy.\n\nThe TLS Termination Proxy would then encrypt the response using the cryptography agreed before (that started with the certificate for someapp.example.com), and send it back to the browser.\n\nNext, the browser would verify that the response is valid and encrypted with the right cryptographic key, etc. It would then decrypt the response and process it.\n\nThe client (browser) will know that the response comes from the correct server because it is using the cryptography they agreed using the HTTPS certificate before.\n\nIn the same server (or servers), there could be multiple applications, for example, other API programs or a database.\n\nOnly one process can be handling the specific IP and port (the TLS Termination Proxy in our example) but the other applications/processes can be running on the server(s) too, as long as they don't try to use the same combination of public IP and port.\n\nThat way, the TLS Termination Proxy could handle HTTPS and certificates for multiple domains, for multiple applications, and then transmit the requests to the right application in each case.\n\nAt some point in the future, each certificate would expire (about 3 months after acquiring it).\n\nAnd then, there would be another program (in some cases it's another program, in some cases it could be the same TLS Termination Proxy) that would talk to Let's Encrypt, and renew the certificate(s).\n\nThe TLS certificates are associated with a domain name, not with an IP address.\n\nSo, to renew the certificates, the renewal program needs to prove to the authority (Let's Encrypt) that it indeed \"owns\" and controls that domain.\n\nTo do that, and to accommodate different application needs, there are several ways it can do it. Some popular ways are:\n\nAll this renewal process, while still serving the app, is one of the main reasons why you would want to have a separate system to handle HTTPS with a TLS Termination Proxy instead of just using the TLS certificates with the application server directly (e.g. Uvicorn).\n\nWhen using a proxy to handle HTTPS, your application server (for example Uvicorn via FastAPI CLI) doesn't known anything about the HTTPS process, it communicates with plain HTTP with the TLS Termination Proxy.\n\nThis proxy would normally set some HTTP headers on the fly before transmitting the request to the application server, to let the application server know that the request is being forwarded by the proxy.\n\nThe proxy headers are:\n\nNevertheless, as the application server doesn't know it is behind a trusted proxy, by default, it wouldn't trust those headers.\n\nBut you can configure the application server to trust the forwarded headers sent by the proxy. If you are using FastAPI CLI, you can use the CLI Option --forwarded-allow-ips to tell it from which IPs it should trust those forwarded headers.\n\nFor example, if the application server is only receiving communication from the trusted proxy, you can set it to --forwarded-allow-ips=\"*\" to make it trust all incoming IPs, as it will only receive requests from whatever is the IP used by the proxy.\n\nThis way the application would be able to know what is its own public URL, if it is using HTTPS, the domain, etc.\n\nThis would be useful for example to properly handle redirects.\n\nYou can learn more about this in the documentation for Behind a Proxy - Enable Proxy Forwarded Headers\n\nHaving HTTPS is very important, and quite critical in most cases. Most of the effort you as a developer have to put around HTTPS is just about understanding these concepts and how they work.\n\nBut once you know the basic information of HTTPS for developers you can easily combine and configure different tools to help you manage everything in a simple way.\n\nIn some of the next chapters, I'll show you several concrete examples of how to set up HTTPS for FastAPI applications. ðŸ”’",
  "headings": [
    {
      "level": "h1",
      "text": "About HTTPSÂ¶",
      "id": "about-https"
    },
    {
      "level": "h2",
      "text": "Let's EncryptÂ¶",
      "id": "lets-encrypt"
    },
    {
      "level": "h2",
      "text": "HTTPS for DevelopersÂ¶",
      "id": "https-for-developers"
    },
    {
      "level": "h3",
      "text": "Domain NameÂ¶",
      "id": "domain-name"
    },
    {
      "level": "h3",
      "text": "DNSÂ¶",
      "id": "dns"
    },
    {
      "level": "h3",
      "text": "TLS Handshake StartÂ¶",
      "id": "tls-handshake-start"
    },
    {
      "level": "h3",
      "text": "TLS with SNI ExtensionÂ¶",
      "id": "tls-with-sni-extension"
    },
    {
      "level": "h3",
      "text": "HTTPS RequestÂ¶",
      "id": "https-request"
    },
    {
      "level": "h3",
      "text": "Decrypt the RequestÂ¶",
      "id": "decrypt-the-request"
    },
    {
      "level": "h3",
      "text": "HTTP ResponseÂ¶",
      "id": "http-response"
    },
    {
      "level": "h3",
      "text": "HTTPS ResponseÂ¶",
      "id": "https-response"
    },
    {
      "level": "h3",
      "text": "Multiple ApplicationsÂ¶",
      "id": "multiple-applications"
    },
    {
      "level": "h3",
      "text": "Certificate RenewalÂ¶",
      "id": "certificate-renewal"
    },
    {
      "level": "h2",
      "text": "Proxy Forwarded HeadersÂ¶",
      "id": "proxy-forwarded-headers"
    },
    {
      "level": "h2",
      "text": "RecapÂ¶",
      "id": "recap"
    }
  ],
  "code_samples": [],
  "patterns": [],
  "links": [
    "https://fastapi.tiangolo.com/deployment/https/",
    "https://fastapi.tiangolo.com/deployment/https/?q=",
    "https://fastapi.tiangolo.com/features/",
    "https://fastapi.tiangolo.com/reference/",
    "https://fastapi.tiangolo.com/python-types/",
    "https://fastapi.tiangolo.com/async/",
    "https://fastapi.tiangolo.com/environment-variables/",
    "https://fastapi.tiangolo.com/virtual-environments/",
    "https://fastapi.tiangolo.com/tutorial/",
    "https://fastapi.tiangolo.com/tutorial/first-steps/",
    "https://fastapi.tiangolo.com/tutorial/path-params/",
    "https://fastapi.tiangolo.com/tutorial/query-params/",
    "https://fastapi.tiangolo.com/tutorial/body/",
    "https://fastapi.tiangolo.com/tutorial/query-params-str-validations/",
    "https://fastapi.tiangolo.com/tutorial/path-params-numeric-validations/",
    "https://fastapi.tiangolo.com/tutorial/query-param-models/",
    "https://fastapi.tiangolo.com/tutorial/body-multiple-params/",
    "https://fastapi.tiangolo.com/tutorial/body-fields/",
    "https://fastapi.tiangolo.com/tutorial/body-nested-models/",
    "https://fastapi.tiangolo.com/tutorial/schema-extra-example/",
    "https://fastapi.tiangolo.com/tutorial/extra-data-types/",
    "https://fastapi.tiangolo.com/tutorial/cookie-params/",
    "https://fastapi.tiangolo.com/tutorial/header-params/",
    "https://fastapi.tiangolo.com/tutorial/cookie-param-models/",
    "https://fastapi.tiangolo.com/tutorial/header-param-models/",
    "https://fastapi.tiangolo.com/tutorial/response-model/",
    "https://fastapi.tiangolo.com/tutorial/extra-models/",
    "https://fastapi.tiangolo.com/tutorial/response-status-code/",
    "https://fastapi.tiangolo.com/tutorial/request-forms/",
    "https://fastapi.tiangolo.com/tutorial/request-form-models/",
    "https://fastapi.tiangolo.com/tutorial/request-files/",
    "https://fastapi.tiangolo.com/tutorial/request-forms-and-files/",
    "https://fastapi.tiangolo.com/tutorial/handling-errors/",
    "https://fastapi.tiangolo.com/tutorial/path-operation-configuration/",
    "https://fastapi.tiangolo.com/tutorial/encoder/",
    "https://fastapi.tiangolo.com/tutorial/body-updates/",
    "https://fastapi.tiangolo.com/tutorial/dependencies/",
    "https://fastapi.tiangolo.com/tutorial/dependencies/classes-as-dependencies/",
    "https://fastapi.tiangolo.com/tutorial/dependencies/sub-dependencies/",
    "https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-in-path-operation-decorators/",
    "https://fastapi.tiangolo.com/tutorial/dependencies/global-dependencies/",
    "https://fastapi.tiangolo.com/tutorial/dependencies/dependencies-with-yield/",
    "https://fastapi.tiangolo.com/tutorial/security/",
    "https://fastapi.tiangolo.com/tutorial/security/first-steps/",
    "https://fastapi.tiangolo.com/tutorial/security/get-current-user/",
    "https://fastapi.tiangolo.com/tutorial/security/simple-oauth2/",
    "https://fastapi.tiangolo.com/tutorial/security/oauth2-jwt/",
    "https://fastapi.tiangolo.com/tutorial/middleware/",
    "https://fastapi.tiangolo.com/tutorial/cors/",
    "https://fastapi.tiangolo.com/tutorial/sql-databases/",
    "https://fastapi.tiangolo.com/tutorial/bigger-applications/",
    "https://fastapi.tiangolo.com/tutorial/background-tasks/",
    "https://fastapi.tiangolo.com/tutorial/metadata/",
    "https://fastapi.tiangolo.com/tutorial/static-files/",
    "https://fastapi.tiangolo.com/tutorial/testing/",
    "https://fastapi.tiangolo.com/tutorial/debugging/",
    "https://fastapi.tiangolo.com/advanced/",
    "https://fastapi.tiangolo.com/advanced/path-operation-advanced-configuration/",
    "https://fastapi.tiangolo.com/advanced/additional-status-codes/",
    "https://fastapi.tiangolo.com/advanced/response-directly/",
    "https://fastapi.tiangolo.com/advanced/custom-response/",
    "https://fastapi.tiangolo.com/advanced/additional-responses/",
    "https://fastapi.tiangolo.com/advanced/response-cookies/",
    "https://fastapi.tiangolo.com/advanced/response-headers/",
    "https://fastapi.tiangolo.com/advanced/response-change-status-code/",
    "https://fastapi.tiangolo.com/advanced/advanced-dependencies/",
    "https://fastapi.tiangolo.com/advanced/security/",
    "https://fastapi.tiangolo.com/advanced/security/oauth2-scopes/",
    "https://fastapi.tiangolo.com/advanced/security/http-basic-auth/",
    "https://fastapi.tiangolo.com/advanced/using-request-directly/",
    "https://fastapi.tiangolo.com/advanced/dataclasses/",
    "https://fastapi.tiangolo.com/advanced/middleware/",
    "https://fastapi.tiangolo.com/advanced/sub-applications/",
    "https://fastapi.tiangolo.com/advanced/behind-a-proxy/",
    "https://fastapi.tiangolo.com/advanced/templates/",
    "https://fastapi.tiangolo.com/advanced/websockets/",
    "https://fastapi.tiangolo.com/advanced/events/",
    "https://fastapi.tiangolo.com/advanced/testing-websockets/",
    "https://fastapi.tiangolo.com/advanced/testing-events/",
    "https://fastapi.tiangolo.com/advanced/testing-dependencies/",
    "https://fastapi.tiangolo.com/advanced/async-tests/",
    "https://fastapi.tiangolo.com/advanced/settings/",
    "https://fastapi.tiangolo.com/advanced/openapi-callbacks/",
    "https://fastapi.tiangolo.com/advanced/openapi-webhooks/",
    "https://fastapi.tiangolo.com/advanced/wsgi/",
    "https://fastapi.tiangolo.com/advanced/generate-clients/",
    "https://fastapi.tiangolo.com/fastapi-cli/",
    "https://fastapi.tiangolo.com/deployment/",
    "https://fastapi.tiangolo.com/deployment/versions/",
    "https://fastapi.tiangolo.com/deployment/fastapicloud/",
    "https://fastapi.tiangolo.com/deployment/manually/",
    "https://fastapi.tiangolo.com/deployment/concepts/",
    "https://fastapi.tiangolo.com/deployment/cloud/",
    "https://fastapi.tiangolo.com/deployment/server-workers/",
    "https://fastapi.tiangolo.com/deployment/docker/",
    "https://fastapi.tiangolo.com/how-to/",
    "https://fastapi.tiangolo.com/how-to/general/",
    "https://fastapi.tiangolo.com/how-to/migrate-from-pydantic-v1-to-pydantic-v2/",
    "https://fastapi.tiangolo.com/how-to/graphql/",
    "https://fastapi.tiangolo.com/how-to/custom-request-and-route/",
    "https://fastapi.tiangolo.com/how-to/conditional-openapi/",
    "https://fastapi.tiangolo.com/how-to/extending-openapi/",
    "https://fastapi.tiangolo.com/how-to/separate-openapi-schemas/",
    "https://fastapi.tiangolo.com/how-to/custom-docs-ui-assets/",
    "https://fastapi.tiangolo.com/how-to/configure-swagger-ui/",
    "https://fastapi.tiangolo.com/how-to/testing-database/",
    "https://fastapi.tiangolo.com/how-to/authentication-error-status-code/",
    "https://fastapi.tiangolo.com/reference/fastapi/",
    "https://fastapi.tiangolo.com/reference/parameters/",
    "https://fastapi.tiangolo.com/reference/status/",
    "https://fastapi.tiangolo.com/reference/uploadfile/",
    "https://fastapi.tiangolo.com/reference/exceptions/",
    "https://fastapi.tiangolo.com/reference/dependencies/",
    "https://fastapi.tiangolo.com/reference/apirouter/",
    "https://fastapi.tiangolo.com/reference/background/",
    "https://fastapi.tiangolo.com/reference/request/",
    "https://fastapi.tiangolo.com/reference/websockets/",
    "https://fastapi.tiangolo.com/reference/httpconnection/",
    "https://fastapi.tiangolo.com/reference/response/",
    "https://fastapi.tiangolo.com/reference/responses/",
    "https://fastapi.tiangolo.com/reference/middleware/",
    "https://fastapi.tiangolo.com/reference/openapi/",
    "https://fastapi.tiangolo.com/reference/openapi/docs/",
    "https://fastapi.tiangolo.com/reference/openapi/models/",
    "https://fastapi.tiangolo.com/reference/security/",
    "https://fastapi.tiangolo.com/reference/encoders/",
    "https://fastapi.tiangolo.com/reference/staticfiles/",
    "https://fastapi.tiangolo.com/reference/templating/",
    "https://fastapi.tiangolo.com/reference/testclient/"
  ]
}