{
  "url": "https://docs.nestjs.com/openapi/cli-plugin",
  "title": "",
  "content": "TypeScript's metadata reflection system has several limitations which make it impossible to, for instance, determine what properties a class consists of or recognize whether a given property is optional or required. However, some of these constraints can be addressed at compilation time. Nest provides a plugin that enhances the TypeScript compilation process to reduce the amount of boilerplate code required.\n\nThe Swagger plugin will automatically:\n\nPlease, note that your filenames must have one of the following suffixes: ['.dto.ts', '.entity.ts'] (e.g., create-user.dto.ts) in order to be analysed by the plugin.\n\nIf you are using a different suffix, you can adjust the plugin's behavior by specifying the dtoFileNameSuffix option (see below).\n\nPreviously, if you wanted to provide an interactive experience with the Swagger UI, you had to duplicate a lot of code to let the package know how your models/components should be declared in the specification. For example, you could define a simple CreateUserDto class as follows:\n\nWhile not a significant issue with medium-sized projects, it becomes verbose & hard to maintain once you have a large set of classes.\n\nBy enabling the Swagger plugin, the above class definition can be declared simply:\n\nHence, if you intend to rely on automatic annotations for generating documentations and still wish for runtime validations, then the class-validator decorators are still necessary.\n\nThe plugin adds appropriate decorators on the fly based on the Abstract Syntax Tree. Thus you won't have to struggle with @ApiProperty decorators scattered throughout the code.\n\nWith the comments introspection feature enabled, CLI plugin will generate descriptions and example values for properties based on comments.\n\nFor example, given an example roles property:\n\nYou must duplicate both description and example values. With introspectComments enabled, the CLI plugin can extract these comments and automatically provide descriptions (and examples, if defined) for properties. Now, the above property can be declared simply as follows:\n\nThere are dtoKeyOfComment and controllerKeyOfComment plugin options available for customizing how the plugin assigns values to the ApiProperty and ApiOperation decorators, respectively. See the example below:\n\nThis is equivalent to the following instruction:\n\nFor controllers, you can provide not only a summary but also a description (remarks), tags (such as @deprecated), and response examples, like this:\n\nTo enable the plugin, open nest-cli.json (if you use Nest CLI) and add the following plugins configuration:\n\nYou can use the options property to customize the behavior of the plugin.\n\nThe options property has to fulfill the following interface:\n\nMake sure to delete the /dist folder and rebuild your application whenever plugin options are updated. If you don't use the CLI but instead have a custom webpack configuration, you can use this plugin in combination with ts-loader:\n\nFor standard setups (non-monorepo), to use CLI Plugins with the SWC builder, you need to enable type checking, as described here.\n\nFor monorepo setups, follow the instructions here.\n\nNow, the serialized metadata file must be loaded by the SwaggerModule#loadPluginMetadata method, as shown below:\n\nTo run e2e tests, ts-jest compiles your source code files on the fly, in memory. This means, it doesn't use Nest CLI compiler and does not apply any plugins or perform AST transformations.\n\nTo enable the plugin, create the following file in your e2e tests directory:\n\nWith this in place, import AST transformer within your jest configuration file. By default (in the starter application), e2e tests configuration file is located under the test folder and is named jest-e2e.json.\n\nIf you use jest@<29, then use the snippet below.\n\nIf you use jest@^29, then use the snippet below, as the previous approach got deprecated.\n\nIn case jest does not seem to pick up your configuration changes, it's possible that Jest has already cached the build result. To apply the new configuration, you need to clear Jest's cache directory.\n\nTo clear the cache directory, run the following command in your NestJS project folder:\n\nIn case the automatic cache clearance fails, you can still manually remove the cache folder with the following commands:",
  "headings": [
    {
      "level": "h3",
      "text": "CLI Plugin",
      "id": "cli-plugin"
    },
    {
      "level": "h4",
      "text": "Overview#",
      "id": "overview"
    },
    {
      "level": "h4",
      "text": "Comments introspection#",
      "id": "comments-introspection"
    },
    {
      "level": "h4",
      "text": "Using the CLI plugin#",
      "id": "using-the-cli-plugin"
    },
    {
      "level": "h4",
      "text": "SWC builder#",
      "id": "swc-builder"
    },
    {
      "level": "h4",
      "text": "Integration with ts-jest (e2e tests)#",
      "id": "integration-with-ts-jest-e2e-tests"
    },
    {
      "level": "h4",
      "text": "Troubleshooting jest (e2e tests)#",
      "id": "troubleshooting-jest-e2e-tests"
    }
  ],
  "code_samples": [
    {
      "code": "export class CreateUserDto {\n  @ApiProperty()\n  email: string;\n\n  @ApiProperty()\n  password: string;\n\n  @ApiProperty({ enum: RoleEnum, default: [], isArray: true })\n  roles: RoleEnum[] = [];\n\n  @ApiProperty({ required: false, default: true })\n  isEnabled?: boolean = true;\n}",
      "language": "typescript"
    },
    {
      "code": "export class CreateUserDto {\n  email: string;\n  password: string;\n  roles: RoleEnum[] = [];\n  isEnabled?: boolean = true;\n}",
      "language": "typescript"
    },
    {
      "code": "/**\n * A list of user's roles\n * @example ['admin']\n */\n@ApiProperty({\n  description: `A list of user's roles`,\n  example: ['admin'],\n})\nroles: RoleEnum[] = [];",
      "language": "typescript"
    },
    {
      "code": "/**\n * A list of user's roles\n * @example ['admin']\n */\nroles: RoleEnum[] = [];",
      "language": "typescript"
    },
    {
      "code": "export class SomeController {\n  /**\n   * Create some resource\n   */\n  @Post()\n  create() {}\n}",
      "language": "typescript"
    },
    {
      "code": "@ApiOperation({ summary: \"Create some resource\" })",
      "language": "typescript"
    },
    {
      "code": "/**\n * Create a new cat\n *\n * @remarks This operation allows you to create a new cat.\n *\n * @deprecated\n * @throws {500} Something went wrong.\n * @throws {400} Bad Request.\n */\n@Post()\nasync create(): Promise<Cat> {}",
      "language": "typescript"
    },
    {
      "code": "{\n  \"collection\": \"@nestjs/schematics\",\n  \"sourceRoot\": \"src\",\n  \"compilerOptions\": {\n    \"plugins\": [\"@nestjs/swagger\"]\n  }\n}",
      "language": "javascript"
    },
    {
      "code": "{\n  \"collection\": \"@nestjs/schematics\",\n  \"sourceRoot\": \"src\",\n  \"compilerOptions\": {\n    \"plugins\": [\n      {\n        \"name\": \"@nestjs/swagger\",\n        \"options\": {\n          \"classValidatorShim\": false,\n          \"introspectComments\": true,\n          \"skipAutoHttpCode\": true\n        }\n      }\n    ]\n  }\n}",
      "language": "javascript"
    },
    {
      "code": "export interface PluginOptions {\n  dtoFileNameSuffix?: string[];\n  controllerFileNameSuffix?: string[];\n  classValidatorShim?: boolean;\n  dtoKeyOfComment?: string;\n  controllerKeyOfComment?: string;\n  introspectComments?: boolean;\n  skipAutoHttpCode?: boolean;\n  esmCompatible?: boolean;\n}",
      "language": "typescript"
    },
    {
      "code": "getCustomTransformers: (program: any) => ({\n  before: [require('@nestjs/swagger/plugin').before({}, program)]\n}),",
      "language": "javascript"
    },
    {
      "code": "$ nest start -b swc --type-check",
      "language": "bash"
    },
    {
      "code": "$ npx ts-node src/generate-metadata.ts\n# OR npx ts-node apps/{YOUR_APP}/src/generate-metadata.ts",
      "language": "bash"
    },
    {
      "code": "import metadata from './metadata'; // <-- file auto-generated by the \"PluginMetadataGenerator\"\n\nawait SwaggerModule.loadPluginMetadata(metadata); // <-- here\nconst document = SwaggerModule.createDocument(app, config);",
      "language": "typescript"
    },
    {
      "code": "const transformer = require('@nestjs/swagger/plugin');\n\nmodule.exports.name = 'nestjs-swagger-transformer';\n// you should change the version number anytime you change the configuration below - otherwise, jest will not detect changes\nmodule.exports.version = 1;\n\nmodule.exports.factory = (cs) => {\n  return transformer.before(\n    {\n      // @nestjs/swagger/plugin options (can be empty)\n    },\n    cs.program, // \"cs.tsCompiler.program\" for older versions of Jest (<= v27)\n  );\n};",
      "language": "javascript"
    },
    {
      "code": "{\n  ... // other configuration\n  \"globals\": {\n    \"ts-jest\": {\n      \"astTransformers\": {\n        \"before\": [\"<path to the file created above>\"]\n      }\n    }\n  }\n}",
      "language": "json"
    },
    {
      "code": "{\n  ... // other configuration\n  \"transform\": {\n    \"^.+\\\\.(t|j)s$\": [\n      \"ts-jest\",\n      {\n        \"astTransformers\": {\n          \"before\": [\"<path to the file created above>\"]\n        }\n      }\n    ]\n  }\n}",
      "language": "json"
    },
    {
      "code": "$ npx jest --clearCache",
      "language": "bash"
    },
    {
      "code": "# Find jest cache directory (usually /tmp/jest_rs)\n# by running the following command in your NestJS project root\n$ npx jest --showConfig | grep cache\n# ex result:\n#   \"cache\": true,\n#   \"cacheDirectory\": \"/tmp/jest_rs\"\n\n# Remove or empty the Jest cache directory\n$ rm -rf  <cacheDirectory value>\n# ex:\n# rm -rf /tmp/jest_rs",
      "language": "bash"
    }
  ],
  "patterns": [],
  "links": [
    "https://docs.nestjs.com/first-steps",
    "https://docs.nestjs.com/controllers",
    "https://docs.nestjs.com/providers",
    "https://docs.nestjs.com/modules",
    "https://docs.nestjs.com/middleware",
    "https://docs.nestjs.com/exception-filters",
    "https://docs.nestjs.com/pipes",
    "https://docs.nestjs.com/guards",
    "https://docs.nestjs.com/interceptors",
    "https://docs.nestjs.com/custom-decorators",
    "https://docs.nestjs.com/fundamentals/custom-providers",
    "https://docs.nestjs.com/fundamentals/async-providers",
    "https://docs.nestjs.com/fundamentals/dynamic-modules",
    "https://docs.nestjs.com/fundamentals/injection-scopes",
    "https://docs.nestjs.com/fundamentals/circular-dependency",
    "https://docs.nestjs.com/fundamentals/module-ref",
    "https://docs.nestjs.com/fundamentals/lazy-loading-modules",
    "https://docs.nestjs.com/fundamentals/execution-context",
    "https://docs.nestjs.com/fundamentals/lifecycle-events",
    "https://docs.nestjs.com/fundamentals/discovery-service",
    "https://docs.nestjs.com/fundamentals/platform-agnosticism",
    "https://docs.nestjs.com/fundamentals/testing",
    "https://docs.nestjs.com/techniques/configuration",
    "https://docs.nestjs.com/techniques/database",
    "https://docs.nestjs.com/techniques/mongodb",
    "https://docs.nestjs.com/techniques/validation",
    "https://docs.nestjs.com/techniques/caching",
    "https://docs.nestjs.com/techniques/serialization",
    "https://docs.nestjs.com/techniques/versioning",
    "https://docs.nestjs.com/techniques/task-scheduling",
    "https://docs.nestjs.com/techniques/queues",
    "https://docs.nestjs.com/techniques/logger",
    "https://docs.nestjs.com/techniques/cookies",
    "https://docs.nestjs.com/techniques/events",
    "https://docs.nestjs.com/techniques/compression",
    "https://docs.nestjs.com/techniques/file-upload",
    "https://docs.nestjs.com/techniques/streaming-files",
    "https://docs.nestjs.com/techniques/http-module",
    "https://docs.nestjs.com/techniques/session",
    "https://docs.nestjs.com/techniques/mvc",
    "https://docs.nestjs.com/techniques/performance",
    "https://docs.nestjs.com/techniques/server-sent-events",
    "https://docs.nestjs.com/security/authentication",
    "https://docs.nestjs.com/security/authorization",
    "https://docs.nestjs.com/security/encryption-and-hashing",
    "https://docs.nestjs.com/security/helmet",
    "https://docs.nestjs.com/security/cors",
    "https://docs.nestjs.com/security/csrf",
    "https://docs.nestjs.com/security/rate-limiting",
    "https://docs.nestjs.com/graphql/quick-start",
    "https://docs.nestjs.com/graphql/resolvers",
    "https://docs.nestjs.com/graphql/mutations",
    "https://docs.nestjs.com/graphql/subscriptions",
    "https://docs.nestjs.com/graphql/scalars",
    "https://docs.nestjs.com/graphql/directives",
    "https://docs.nestjs.com/graphql/interfaces",
    "https://docs.nestjs.com/graphql/unions-and-enums",
    "https://docs.nestjs.com/graphql/field-middleware",
    "https://docs.nestjs.com/graphql/mapped-types",
    "https://docs.nestjs.com/graphql/plugins",
    "https://docs.nestjs.com/graphql/complexity",
    "https://docs.nestjs.com/graphql/extensions",
    "https://docs.nestjs.com/graphql/cli-plugin",
    "https://docs.nestjs.com/graphql/generating-sdl",
    "https://docs.nestjs.com/graphql/sharing-models",
    "https://docs.nestjs.com/graphql/other-features",
    "https://docs.nestjs.com/graphql/federation",
    "https://docs.nestjs.com/websockets/gateways",
    "https://docs.nestjs.com/websockets/exception-filters",
    "https://docs.nestjs.com/websockets/pipes",
    "https://docs.nestjs.com/websockets/guards",
    "https://docs.nestjs.com/websockets/interceptors",
    "https://docs.nestjs.com/websockets/adapter",
    "https://docs.nestjs.com/microservices/basics",
    "https://docs.nestjs.com/microservices/redis",
    "https://docs.nestjs.com/microservices/mqtt",
    "https://docs.nestjs.com/microservices/nats",
    "https://docs.nestjs.com/microservices/rabbitmq",
    "https://docs.nestjs.com/microservices/kafka",
    "https://docs.nestjs.com/microservices/grpc",
    "https://docs.nestjs.com/microservices/custom-transport",
    "https://docs.nestjs.com/microservices/exception-filters",
    "https://docs.nestjs.com/microservices/pipes",
    "https://docs.nestjs.com/microservices/guards",
    "https://docs.nestjs.com/microservices/interceptors",
    "https://docs.nestjs.com/standalone-applications",
    "https://docs.nestjs.com/cli/overview",
    "https://docs.nestjs.com/cli/monorepo",
    "https://docs.nestjs.com/cli/libraries",
    "https://docs.nestjs.com/cli/usages",
    "https://docs.nestjs.com/cli/scripts",
    "https://docs.nestjs.com/openapi/introduction",
    "https://docs.nestjs.com/openapi/types-and-parameters",
    "https://docs.nestjs.com/openapi/operations",
    "https://docs.nestjs.com/openapi/security",
    "https://docs.nestjs.com/openapi/mapped-types",
    "https://docs.nestjs.com/openapi/decorators",
    "https://docs.nestjs.com/openapi/cli-plugin",
    "https://docs.nestjs.com/openapi/other-features",
    "https://docs.nestjs.com/recipes/repl",
    "https://docs.nestjs.com/recipes/crud-generator",
    "https://docs.nestjs.com/recipes/swc",
    "https://docs.nestjs.com/recipes/passport",
    "https://docs.nestjs.com/recipes/hot-reload",
    "https://docs.nestjs.com/recipes/mikroorm",
    "https://docs.nestjs.com/recipes/sql-typeorm",
    "https://docs.nestjs.com/recipes/mongodb",
    "https://docs.nestjs.com/recipes/sql-sequelize",
    "https://docs.nestjs.com/recipes/router-module",
    "https://docs.nestjs.com/recipes/swagger",
    "https://docs.nestjs.com/recipes/terminus",
    "https://docs.nestjs.com/recipes/cqrs",
    "https://docs.nestjs.com/recipes/documentation",
    "https://docs.nestjs.com/recipes/prisma",
    "https://docs.nestjs.com/recipes/sentry",
    "https://docs.nestjs.com/recipes/serve-static",
    "https://docs.nestjs.com/recipes/nest-commander",
    "https://docs.nestjs.com/recipes/async-local-storage",
    "https://docs.nestjs.com/recipes/necord",
    "https://docs.nestjs.com/recipes/suites",
    "https://docs.nestjs.com/faq/serverless",
    "https://docs.nestjs.com/faq/http-adapter",
    "https://docs.nestjs.com/faq/keep-alive-connections",
    "https://docs.nestjs.com/faq/global-prefix",
    "https://docs.nestjs.com/faq/raw-body",
    "https://docs.nestjs.com/faq/hybrid-application",
    "https://docs.nestjs.com/faq/multiple-servers",
    "https://docs.nestjs.com/faq/request-lifecycle",
    "https://docs.nestjs.com/faq/common-errors"
  ]
}