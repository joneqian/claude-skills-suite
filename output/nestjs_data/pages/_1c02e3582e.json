{
  "url": "https://docs.nestjs.com/migration-guide",
  "title": "",
  "content": "This article offers a comprehensive guide for migrating from NestJS version 10 to version 11. To explore the new features introduced in v11, take a look at this article. While the update includes a few minor breaking changes, they are unlikely to impact most users. You can review the complete list of changes here.\n\nAlthough you can manually upgrade your packages, we recommend using npm-check-updates (ncu) for a more streamlined process.\n\nAfter years of development, Express v5 was officially released in 2024 and became a stable version in 2025. With NestJS 11, Express v5 is now the default version integrated into the framework. While this update is seamless for most users, itâ€™s important to be aware that Express v5 introduces some breaking changes. For detailed guidance, refer to the Express v5 migration guide.\n\nOne of the most notable updates in Express v5 is the revised path route matching algorithm. The following changes have been introduced to how path strings are matched with incoming requests:\n\nThat said, routes that previously worked in Express v4 may not work in Express v5. For example:\n\nTo fix this issue, you can update the route to use a named wildcard:\n\nSimilarly, if you have a middleware that runs on all routes, you may need to update the path to use a named wildcard:\n\nInstead, you can update the path to use a named wildcard:\n\nNote that {*splat} is a named wildcard that matches any path including the root path. Outer braces make path optional.\n\nIn Express v5, query parameters are no longer parsed using the qs library by default. Instead, the simple parser is used, which does not support nested objects or arrays.\n\nAs a result, query strings like these:\n\nwill no longer be parsed as expected. To revert to the previous behavior, you can configure Express to use the extended parser (the default in Express v4) by setting the query parser option to extended:\n\n@nestjs/platform-fastify v11 now finally supports Fastify v5. This update should be seamless for most users; however, Fastify v5 introduces a few breaking changes, though these are unlikely to affect the majority of NestJS users. For more detailed information, refer to the Fastify v5 migration guide.\n\nBy default, only CORS-safelisted methods are allowed. If you need to enable additional methods (such as PUT, PATCH, or DELETE), you must explicitly define them in the methods option.\n\nNestJS 11 now uses the latest version of the path-to-regexp package to match middleware paths in @nestjs/platform-fastify. As a result, the (.*) syntax for matching all paths is no longer supported. Instead, you should use named wildcards.\n\nFor example, if you have a middleware that applies to all routes:\n\nYou'll need to update it to use a named wildcard instead:\n\nWhere splat is just an arbitrary name for the wildcard parameter. You can name it anything you like.\n\nStarting with NestJS 11, the module resolution algorithm has been improved to enhance performance and reduce memory usage for most applications. This change does not require any manual intervention, but there are some edge cases where the behavior may differ from previous versions.\n\nIn NestJS v10 and earlier, dynamic modules were assigned a unique opaque key generated from the module's dynamic metadata. This key was used to identify the module in the module registry. For example, if you included TypeOrmModule.forFeature([User]) in multiple modules, NestJS would deduplicate the modules and treat them as a single module node in the registry. This process is known as node deduplication.\n\nWith the release of NestJS v11, we no longer generate predictable hashes for dynamic modules. Instead, object references are now used to determine if one module is equivalent to another. To share the same dynamic module across multiple modules, simply assign it to a variable and import it wherever needed. This new approach provides more flexibility and ensures that dynamic modules are handled more efficiently.\n\nThis new algorithm might impact your integration tests if you use a lot of dynamic modules, because without the manually deduplication mentioned above, your TestingModule could have multiple instances of a dependency. This makes it a bit trickier to stub a method, because you'll need to target the correct instance. Your options are to either:\n\nNestJS 11 introduces several improvements to the Reflector class, enhancing its functionality and type inference for metadata values. These updates provide a more intuitive and robust experience when working with metadata.\n\nThese enhancements improve the overall developer experience by providing better type safety and handling of metadata in NestJS 11.\n\nTermination lifecycle hooks are now executed in the reverse order to their initialization counterparts. That said, hooks like OnModuleDestroy, BeforeApplicationShutdown, and OnApplicationShutdown are now executed in the reverse order.\n\nImagine the following scenario:\n\nIn this case, the OnModuleInit hooks are executed in the following order:\n\nWhile the OnModuleDestroy hooks are executed in the reverse order:\n\nIn NestJS v11, the behavior of middleware registration has been updated. Previously, the order of middleware registration was determined by the topological sort of the module dependency graph, where the distance from the root module defined the order of middleware registration, regardless of whether the middleware was registered in a global module or a regular module. Global modules were treated like regular modules in this respect, which led to inconsistent behavior, especially when compared to other framework features.\n\nFrom v11 onwards, middleware registered in global modules is now executed first, regardless of its position in the module dependency graph. This change ensures that global middleware always runs before any middleware from imported modules, maintaining a consistent and predictable order.\n\nThe CacheModule (from the @nestjs/cache-manager package) has been updated to support the latest version of the cache-manager package. This update brings a few breaking changes, including a migration to Keyv, which offers a unified interface for key-value storage across multiple backend stores through storage adapters.\n\nThe key difference between the previous version and the new version lies in the configuration of external stores. In the previous version, to register a Redis store, you would have likely configured it like this:\n\nIn the new version, you should use the Keyv adapter to configure the store:\n\nWhere KeyvRedis is imported from the @keyv/redis package. See the Caching documentation to learn more.\n\nIf you're using the ConfigModule from the @nestjs/config package, be aware of several breaking changes introduced in @nestjs/config@4.0.0. Most notably, the order in which configuration variables are read by the ConfigService#get method has been updated. The new order is:\n\nPreviously, validated environment variables and the process.env object were read first, preventing them from being overridden by internal configuration. With this update, internal configuration will now always take precedence over environment variables.\n\nAdditionally, the ignoreEnvVars configuration option, which previously allowed disabling validation of the process.env object, has been deprecated. Instead, use the validatePredefined option (set to false to disable validation of predefined environment variables). Predefined environment variables refer to process.env variables that were set before the module was imported. For example, if you start your application with PORT=3000 node main.js, the PORT variable is considered predefined. However, variables loaded by the ConfigModule from a .env file are not classified as predefined.\n\nA new skipProcessEnv option has also been introduced. This option allows you to prevent the ConfigService#get method from accessing the process.env object entirely, which can be helpful when you want to restrict the service from reading environment variables directly.\n\nIf you are using the TerminusModule and have built your own custom health indicator, a new API has been introduced in version 11. The new HealthIndicatorService is designed to enhance the readability and testability of custom health indicators.\n\nBefore version 11, a health indicator might have looked like this:\n\nStarting with version 11, it is recommended to use the new HealthIndicatorService API, which streamlines the implementation process. Here's how the same health indicator can now be implemented:\n\nStarting with NestJS 11, Node.js v16 is no longer supported, as it reached its end-of-life (EOL) on September 11, 2023. Likewise, the security support is scheduled to end on April 30, 2025 for Node.js v18, so we went ahead and dropped support for it as well.\n\nNestJS 11 now requires Node.js v20 or higher.\n\nTo ensure the best experience, we strongly recommend using the latest LTS version of Node.js.\n\nIn case you missed the announcement, we launched our official deployment platform, Mau, in 2024. Mau is a fully managed platform that simplifies the deployment process for NestJS applications. With Mau, you can deploy your applications to the cloud (AWS; Amazon Web Services) with a single command, manage your environment variables, and monitor your application's performance in real-time.\n\nMau makes provisioning and maintaining your infrastructure as simple as clicking just a few buttons. Mau is designed to be simple and intuitive, so you can focus on building your applications and not worry about the underlying infrastructure. Under the hood, we use Amazon Web Services to provide you with a powerful and reliable platform, while abstracting away all the complexity of AWS. We take care of all the heavy lifting for you, so you can focus on building your applications and growing your business.\n\nYou can learn more about Mau in this chapter.",
  "headings": [
    {
      "level": "h3",
      "text": "Migration guide",
      "id": "migration-guide"
    },
    {
      "level": "h4",
      "text": "Upgrading packages#",
      "id": "upgrading-packages"
    },
    {
      "level": "h4",
      "text": "Express v5#",
      "id": "express-v5"
    },
    {
      "level": "h4",
      "text": "Query parameters parsing#",
      "id": "query-parameters-parsing"
    },
    {
      "level": "h4",
      "text": "Fastify v5#",
      "id": "fastify-v5"
    },
    {
      "level": "h4",
      "text": "Fastify CORS#",
      "id": "fastify-cors"
    },
    {
      "level": "h4",
      "text": "Fastify middleware registration#",
      "id": "fastify-middleware-registration"
    },
    {
      "level": "h4",
      "text": "Module resolution algorithm#",
      "id": "module-resolution-algorithm"
    },
    {
      "level": "h4",
      "text": "Reflector type inference#",
      "id": "reflector-type-inference"
    },
    {
      "level": "h4",
      "text": "Lifecycle hooks execution order#",
      "id": "lifecycle-hooks-execution-order"
    },
    {
      "level": "h4",
      "text": "Middleware registration order#",
      "id": "middleware-registration-order"
    },
    {
      "level": "h4",
      "text": "Cache module#",
      "id": "cache-module"
    },
    {
      "level": "h4",
      "text": "Config module#",
      "id": "config-module"
    },
    {
      "level": "h4",
      "text": "Terminus module#",
      "id": "terminus-module"
    },
    {
      "level": "h4",
      "text": "Node.js v16 and v18 no longer supported#",
      "id": "nodejs-v16-and-v18-no-longer-supported"
    },
    {
      "level": "h4",
      "text": "Mau official deployment platform#",
      "id": "mau-official-deployment-platform"
    }
  ],
  "code_samples": [
    {
      "code": "@Get('users/*')\nfindAll() {\n  // In NestJS 11, this will be automatically converted to a valid Express v5 route.\n  // While it may still work, it's no longer advisable to use this wildcard syntax in Express v5.\n  return 'This route should not work in Express v5';\n}",
      "language": "typescript"
    },
    {
      "code": "@Get('users/*splat')\nfindAll() {\n  return 'This route will work in Express v5';\n}",
      "language": "typescript"
    },
    {
      "code": "// In NestJS 11, this will be automatically converted to a valid Express v5 route.\n// While it may still work, it's no longer advisable to use this wildcard syntax in Express v5.\nforRoutes('*'); // <-- This should not work in Express v5",
      "language": "typescript"
    },
    {
      "code": "forRoutes('{*splat}'); // <-- This will work in Express v5",
      "language": "typescript"
    },
    {
      "code": "?filter[where][name]=John&filter[where][age]=30\n?item[]=1&item[]=2",
      "language": "unknown"
    },
    {
      "code": "import { NestFactory } from '@nestjs/core';\nimport { NestExpressApplication } from '@nestjs/platform-express';\nimport { AppModule } from './app.module';\n\nasync function bootstrap() {\n  const app = await NestFactory.create<NestExpressApplication>(AppModule); // <-- Make sure to use <NestExpressApplication>\n  app.set('query parser', 'extended'); // <-- Add this line\n  await app.listen(3000);\n}\nbootstrap();",
      "language": "typescript"
    },
    {
      "code": "const methods = ['GET', 'POST', 'PUT', 'PATCH', 'DELETE']; // OR comma-delimited string 'GET,POST,PUT,PATH,DELETE'\n\nconst app = await NestFactory.create<NestFastifyApplication>(\n  AppModule,\n  new FastifyAdapter(),\n  { cors: { methods } },\n);\n\n// OR alternatively, you can use the `enableCors` method\nconst app = await NestFactory.create<NestFastifyApplication>(\n  AppModule,\n  new FastifyAdapter(),\n);\napp.enableCors({ methods });",
      "language": "typescript"
    },
    {
      "code": "// In NestJS 11, this will automatically be converted to a valid route, even if you don't update it.\n.forRoutes('(.*)');",
      "language": "typescript"
    },
    {
      "code": ".forRoutes('*splat');",
      "language": "typescript"
    },
    {
      "code": "// Where A, B, and C are modules and \"->\" represents the module dependency.\nA -> B -> C",
      "language": "julia"
    },
    {
      "code": "C -> B -> A",
      "language": "php"
    },
    {
      "code": "A -> B -> C",
      "language": "php"
    },
    {
      "code": "// Old version - no longer supported\nCacheModule.registerAsync({\n  useFactory: async () => {\n    const store = await redisStore({\n      socket: {\n        host: 'localhost',\n        port: 6379,\n      },\n    });\n\n    return {\n      store,\n    };\n  },\n}),",
      "language": "javascript"
    },
    {
      "code": "// New version - supported\nCacheModule.registerAsync({\n  useFactory: async () => {\n    return {\n      stores: [\n        new KeyvRedis('redis://localhost:6379'),\n      ],\n    };\n  },\n}),",
      "language": "css"
    },
    {
      "code": "@Injectable()\nexport class DogHealthIndicator extends HealthIndicator {\n  constructor(private readonly httpService: HttpService) {\n    super();\n  }\n\n  async isHealthy(key: string) {\n    try {\n      const badboys = await this.getBadboys();\n      const isHealthy = badboys.length === 0;\n\n      const result = this.getStatus(key, isHealthy, {\n        badboys: badboys.length,\n      });\n\n      if (!isHealthy) {\n        throw new HealthCheckError('Dog check failed', result);\n      }\n\n      return result;\n    } catch (error) {\n      const result = this.getStatus(key, isHealthy);\n      throw new HealthCheckError('Dog check failed', result);\n    }\n  }\n\n  private getBadboys() {\n    return firstValueFrom(\n      this.httpService.get<Dog[]>('https://example.com/dog').pipe(\n        map((response) => response.data),\n        map((dogs) => dogs.filter((dog) => dog.state === DogState.BAD_BOY)),\n      ),\n    );\n  }\n}",
      "language": "typescript"
    },
    {
      "code": "@Injectable()\nexport class DogHealthIndicator {\n  constructor(\n    private readonly httpService: HttpService,\n    //  Inject the `HealthIndicatorService` provided by the `TerminusModule`\n    private readonly healthIndicatorService: HealthIndicatorService,\n  ) {}\n\n  async isHealthy(key: string) {\n    // Start the health indicator check for the given key\n    const indicator = this.healthIndicatorService.check(key);\n\n    try {\n      const badboys = await this.getBadboys();\n      const isHealthy = badboys.length === 0;\n\n      if (!isHealthy) {\n        // Mark the indicator as \"down\" and add additional info to the response\n        return indicator.down({ badboys: badboys.length });\n      }\n\n      // Mark the health indicator as up\n      return indicator.up();\n    } catch (error) {\n      return indicator.down('Unable to retrieve dogs');\n    }\n  }\n\n  private getBadboys() {\n    // ...\n  }\n}",
      "language": "typescript"
    },
    {
      "code": "$ npm install -g @nestjs/mau\n$ mau deploy",
      "language": "bash"
    }
  ],
  "patterns": [
    {
      "description": "That said, routes that previously worked in Express v4 may not work in Express v5. For example:",
      "code": "@Get('users/*')\nfindAll() {\n  // In NestJS 11, this will be automatically converted to a valid Express v5 route.\n  // While it may still work, it's no longer advisable to use this wildcard syntax in Express v5.\n  return 'This route should not work in Express v5';\n}"
    }
  ],
  "links": [
    "https://docs.nestjs.com/first-steps",
    "https://docs.nestjs.com/controllers",
    "https://docs.nestjs.com/providers",
    "https://docs.nestjs.com/modules",
    "https://docs.nestjs.com/middleware",
    "https://docs.nestjs.com/exception-filters",
    "https://docs.nestjs.com/pipes",
    "https://docs.nestjs.com/guards",
    "https://docs.nestjs.com/interceptors",
    "https://docs.nestjs.com/custom-decorators",
    "https://docs.nestjs.com/fundamentals/custom-providers",
    "https://docs.nestjs.com/fundamentals/async-providers",
    "https://docs.nestjs.com/fundamentals/dynamic-modules",
    "https://docs.nestjs.com/fundamentals/injection-scopes",
    "https://docs.nestjs.com/fundamentals/circular-dependency",
    "https://docs.nestjs.com/fundamentals/module-ref",
    "https://docs.nestjs.com/fundamentals/lazy-loading-modules",
    "https://docs.nestjs.com/fundamentals/execution-context",
    "https://docs.nestjs.com/fundamentals/lifecycle-events",
    "https://docs.nestjs.com/fundamentals/discovery-service",
    "https://docs.nestjs.com/fundamentals/platform-agnosticism",
    "https://docs.nestjs.com/fundamentals/testing",
    "https://docs.nestjs.com/techniques/configuration",
    "https://docs.nestjs.com/techniques/database",
    "https://docs.nestjs.com/techniques/mongodb",
    "https://docs.nestjs.com/techniques/validation",
    "https://docs.nestjs.com/techniques/caching",
    "https://docs.nestjs.com/techniques/serialization",
    "https://docs.nestjs.com/techniques/versioning",
    "https://docs.nestjs.com/techniques/task-scheduling",
    "https://docs.nestjs.com/techniques/queues",
    "https://docs.nestjs.com/techniques/logger",
    "https://docs.nestjs.com/techniques/cookies",
    "https://docs.nestjs.com/techniques/events",
    "https://docs.nestjs.com/techniques/compression",
    "https://docs.nestjs.com/techniques/file-upload",
    "https://docs.nestjs.com/techniques/streaming-files",
    "https://docs.nestjs.com/techniques/http-module",
    "https://docs.nestjs.com/techniques/session",
    "https://docs.nestjs.com/techniques/mvc",
    "https://docs.nestjs.com/techniques/performance",
    "https://docs.nestjs.com/techniques/server-sent-events",
    "https://docs.nestjs.com/security/authentication",
    "https://docs.nestjs.com/security/authorization",
    "https://docs.nestjs.com/security/encryption-and-hashing",
    "https://docs.nestjs.com/security/helmet",
    "https://docs.nestjs.com/security/cors",
    "https://docs.nestjs.com/security/csrf",
    "https://docs.nestjs.com/security/rate-limiting",
    "https://docs.nestjs.com/graphql/quick-start",
    "https://docs.nestjs.com/graphql/resolvers",
    "https://docs.nestjs.com/graphql/mutations",
    "https://docs.nestjs.com/graphql/subscriptions",
    "https://docs.nestjs.com/graphql/scalars",
    "https://docs.nestjs.com/graphql/directives",
    "https://docs.nestjs.com/graphql/interfaces",
    "https://docs.nestjs.com/graphql/unions-and-enums",
    "https://docs.nestjs.com/graphql/field-middleware",
    "https://docs.nestjs.com/graphql/mapped-types",
    "https://docs.nestjs.com/graphql/plugins",
    "https://docs.nestjs.com/graphql/complexity",
    "https://docs.nestjs.com/graphql/extensions",
    "https://docs.nestjs.com/graphql/cli-plugin",
    "https://docs.nestjs.com/graphql/generating-sdl",
    "https://docs.nestjs.com/graphql/sharing-models",
    "https://docs.nestjs.com/graphql/other-features",
    "https://docs.nestjs.com/graphql/federation",
    "https://docs.nestjs.com/websockets/gateways",
    "https://docs.nestjs.com/websockets/exception-filters",
    "https://docs.nestjs.com/websockets/pipes",
    "https://docs.nestjs.com/websockets/guards",
    "https://docs.nestjs.com/websockets/interceptors",
    "https://docs.nestjs.com/websockets/adapter",
    "https://docs.nestjs.com/microservices/basics",
    "https://docs.nestjs.com/microservices/redis",
    "https://docs.nestjs.com/microservices/mqtt",
    "https://docs.nestjs.com/microservices/nats",
    "https://docs.nestjs.com/microservices/rabbitmq",
    "https://docs.nestjs.com/microservices/kafka",
    "https://docs.nestjs.com/microservices/grpc",
    "https://docs.nestjs.com/microservices/custom-transport",
    "https://docs.nestjs.com/microservices/exception-filters",
    "https://docs.nestjs.com/microservices/pipes",
    "https://docs.nestjs.com/microservices/guards",
    "https://docs.nestjs.com/microservices/interceptors",
    "https://docs.nestjs.com/standalone-applications",
    "https://docs.nestjs.com/cli/overview",
    "https://docs.nestjs.com/cli/monorepo",
    "https://docs.nestjs.com/cli/libraries",
    "https://docs.nestjs.com/cli/usages",
    "https://docs.nestjs.com/cli/scripts",
    "https://docs.nestjs.com/openapi/introduction",
    "https://docs.nestjs.com/openapi/types-and-parameters",
    "https://docs.nestjs.com/openapi/operations",
    "https://docs.nestjs.com/openapi/security",
    "https://docs.nestjs.com/openapi/mapped-types",
    "https://docs.nestjs.com/openapi/decorators",
    "https://docs.nestjs.com/openapi/cli-plugin",
    "https://docs.nestjs.com/openapi/other-features",
    "https://docs.nestjs.com/recipes/repl",
    "https://docs.nestjs.com/recipes/crud-generator",
    "https://docs.nestjs.com/recipes/swc",
    "https://docs.nestjs.com/recipes/passport",
    "https://docs.nestjs.com/recipes/hot-reload",
    "https://docs.nestjs.com/recipes/mikroorm",
    "https://docs.nestjs.com/recipes/sql-typeorm",
    "https://docs.nestjs.com/recipes/mongodb",
    "https://docs.nestjs.com/recipes/sql-sequelize",
    "https://docs.nestjs.com/recipes/router-module",
    "https://docs.nestjs.com/recipes/swagger",
    "https://docs.nestjs.com/recipes/terminus",
    "https://docs.nestjs.com/recipes/cqrs",
    "https://docs.nestjs.com/recipes/documentation",
    "https://docs.nestjs.com/recipes/prisma",
    "https://docs.nestjs.com/recipes/sentry",
    "https://docs.nestjs.com/recipes/serve-static",
    "https://docs.nestjs.com/recipes/nest-commander",
    "https://docs.nestjs.com/recipes/async-local-storage",
    "https://docs.nestjs.com/recipes/necord",
    "https://docs.nestjs.com/recipes/suites",
    "https://docs.nestjs.com/faq/serverless",
    "https://docs.nestjs.com/faq/http-adapter",
    "https://docs.nestjs.com/faq/keep-alive-connections",
    "https://docs.nestjs.com/faq/global-prefix",
    "https://docs.nestjs.com/faq/raw-body",
    "https://docs.nestjs.com/faq/hybrid-application",
    "https://docs.nestjs.com/faq/multiple-servers",
    "https://docs.nestjs.com/faq/request-lifecycle",
    "https://docs.nestjs.com/faq/common-errors"
  ]
}